angular.module("TDM-FE").factory("ExcelService",(function(){var generalInfoStructure=[{name:"Task Name",field:"task_name",task_type:"all"},{name:"Task ID",field:"task_id",task_type:"all"},{name:"Task Execution ID",field:"task_execution_id",task_type:"all"},{name:"Created by",field:"created_by",task_type:"all"},{name:"Executed By",field:"executed_by",task_type:"all"},{name:"Execution Time (UTC)",field:"start_execution",task_type:"all"},{name:"Execution Status",field:"execution_status",task_type:"all"},{name:"Source Environment",field:"source_env",task_type:"all"},{name:"Target Environment",field:"target_env",task_type:"load"},{name:"Business Entity Name",field:"be_name",task_type:"all"},{name:"",field:"",task_type:"all"},{name:"Task Properties:",field:"",task_type:"all"},{name:"Task Type:",field:"task_type",task_type:"all"},{name:"Fabric Execution Id:",field:"fabric_execution_id",task_type:"all"},{name:"Selection Method:",field:"selection_method",task_type:"load"},{name:"Task Sync Mode:",field:"task_sync_mode",task_type:"load"},{name:"Env Sync Mode:",field:"env_sync_mode",task_type:"load"},{name:"Operation Mode:",field:"operation_mode",task_type:"load"},{name:"Replace Sequences:",field:"replace_sequences",task_type:"load"},{name:"Task Versioning:",field:"version_ind",task_type:"all"},{name:"Selected Version Name for Entities:",field:"selected_version_task_name",task_type:"load"},{name:"Selected Version Datetime for Entities:",field:"selected_version_datetime",task_type:"load"},{name:"Selected Version Name for Reference Tables:",field:"selected_ref_version_task_name",task_type:"load"},{name:"Selected Version Datetime for Reference Tables:",field:"selected_ref_version_datetime",task_type:"load"},{name:"Scheduling Parameters:",field:"version_ind",task_type:"load"},{name:"Schedule Expiration Date:",field:"schedule_expiration_date",task_type:"load"},{name:"Version Expiration Date:",field:"version_expiration_date",task_type:"extract"},{name:"Retention Period Type:",field:"retention_period_type",task_type:"extract"},{name:"Retention Period Value:",field:"retention_period_value",task_type:"extract"},{name:"Reservation Indicator:",field:"reserve_ind",task_type:"all"},{name:"Reservation Period Type:",field:"reserve_retention_period_type",task_type:"all"},{name:"Reservation Period Value:",field:"reserve_retention_period_value",task_type:"all"}],generalInfo={},buildGeneralInfoTab=function(worksheet){var task_type=generalInfo.task_type;if(generalInfoStructure.forEach((function(field){var value=generalInfo[field.field]||"";("fabric_execution_id"!==field.field||generalInfo[field.field])&&("all"!==field.task_type&&field.task_type!==task_type.toLowerCase()||worksheet.addRow([field.name,""+value]))})),generalInfo.override_parameters)try{const override_parameters=JSON.parse(generalInfo.override_parameters),overrideParametersKeys=Object.keys(override_parameters);if(overrideParametersKeys.length>0){addEmptyLine(worksheet),worksheet.addRow(["Override Parameters"]);let taskGlobals=null,reserveRetentionPeriod=null,retentionPeriod=null;overrideParametersKeys.forEach(key=>{"TASK_GLOBALS"===key?taskGlobals=override_parameters[key]:"RESERVE_RETENTION_PARAMS"===key?reserveRetentionPeriod=override_parameters[key]:"DATAFLUX_RETENTION_PARAMS"===key?retentionPeriod=override_parameters[key]:worksheet.addRow([key,""+override_parameters[key]])}),taskGlobals&&(addEmptyLine(worksheet),worksheet.addRow(["Task Globals"]),Object.keys(taskGlobals).forEach(key=>{worksheet.addRow([key,""+taskGlobals[key]])})),reserveRetentionPeriod&&(addEmptyLine(worksheet),worksheet.addRow(["RESERVE RETENTION PARAMS"]),Object.keys(reserveRetentionPeriod).forEach(key=>{worksheet.addRow([key,""+reserveRetentionPeriod[key]])})),retentionPeriod&&(addEmptyLine(worksheet),worksheet.addRow(["RETENTION PERIOD PARAMS"]),Object.keys(retentionPeriod).forEach(key=>{worksheet.addRow([key,""+retentionPeriod[key]])}))}}catch(err){console.log("unable to parse override parameters"),console.error(err)}},addEmptyLine=function(worksheet){worksheet.addRow([""])},getTableModel=function(data,worksheet,tableName){if(!data||!data.length)return{};var tableCols=[],tableRows=[],currentRow=worksheet.addRow([""]);Object.keys(data[0]).forEach((function(key){tableCols.push({name:key,key:key,width:"77"})}));for(var i=0;i<data.length;i++){var tableRow=[],row=data[i];Object.keys(row).forEach((function(key){tableRow.push(row[key])})),tableRows.push(tableRow)}return{name:tableName,ref:currentRow._cells[0]._address,columns:tableCols,rows:tableRows,style:{}}},addCustomizedRow=function(text,worksheet,customStyle){var row=worksheet.addRow([text]);Object.keys(customStyle).forEach((function(styleAttr){row[styleAttr]=customStyle[styleAttr]}))},addWorksheetTitle=function(titleName,worksheet){addCustomizedRow(titleName,worksheet,{font:{bold:!0,size:14}})},addWorksheetWarning=function(message,worksheet){addCustomizedRow(message,worksheet,{font:{bold:!0,color:{argb:"FF0000"}}})},buildListOfRootEntitiesTab=function(worksheet,tabData){var numOfCopiedEntities=tabData["Number of Copied Entities"][0].number_of_copied_root_entities,listOfCopiedEntities=tabData["List of Copied Entities"],numOfFailedEntities=tabData["Number of Failed Entities"][0].number_of_failed_root_entities,listOfFailedEntities=tabData["List of Failed Entities"];!function(numOfCopiedEntities,listOfCopiedEntities){addWorksheetTitle("Number of "+generalInfo.be_name+" Copied entities:"+numOfCopiedEntities,worksheet),addEmptyLine(worksheet),numOfCopiedEntities>0&&(worksheet.addTable(getTableModel(listOfCopiedEntities,worksheet,"copiedEntitiesTable")),addEmptyLine(worksheet))}(numOfCopiedEntities,listOfCopiedEntities),function(numOfFailedEntities,listOfFailedEntities){addWorksheetTitle("Number of "+generalInfo.be_name+" Failed entities:"+numOfFailedEntities,worksheet),addEmptyLine(worksheet),numOfFailedEntities>0&&(worksheet.addTable(getTableModel(listOfFailedEntities,worksheet,"failedEntitiesTable")),addEmptyLine(worksheet))}(numOfFailedEntities,listOfFailedEntities),addEmptyLine(worksheet)},buildListOfReferenceTables=function(worksheet,tabData){var numOfCopiedEntities=tabData["Number of Copied Reference Tables"][0].count,listOfCopiedEntities=tabData["List of Copied Reference Tables"],numOfFailedEntities=tabData["Number of Failed Reference Tables"][0].count,listOfFailedEntities=tabData["List of Failed Reference Tables"];!function(numOfCopiedEntities,listOfCopiedEntities){addWorksheetTitle("Number of "+generalInfo.be_name+" Copied Reference Tables: "+numOfCopiedEntities,worksheet),addEmptyLine(worksheet),numOfCopiedEntities>0&&(worksheet.addTable(getTableModel(listOfCopiedEntities,worksheet,"copiedRefTable")),addEmptyLine(worksheet))}(numOfCopiedEntities,listOfCopiedEntities),function(numOfFailedEntities,listOfFailedEntities){addWorksheetTitle("Number of "+generalInfo.be_name+" Failed Reference Tables: "+numOfFailedEntities,worksheet),addEmptyLine(worksheet),numOfFailedEntities>0&&(worksheet.addTable(getTableModel(listOfFailedEntities,worksheet,"failedRefTable")),addEmptyLine(worksheet))}(numOfFailedEntities,listOfFailedEntities)},buildErrorSummaryTab=function(worksheet,tabData){tabData&&tabData.length?(worksheet.addTable(getTableModel(tabData,worksheet,"errorSummaryTable")),addEmptyLine(worksheet)):addWorksheetWarning("No Error Summary Report Data",worksheet)},buildExtractTab=function(tabName,tabData,worksheet){switch(tabName){case"General Info":buildGeneralInfoTab(worksheet);break;case"Task Execution Summary":!function(worksheet,tabData){var migrateTableData=[],referenceTableData=[];let lusData=[],pepsData=[];tabData.forEach(item=>{item&&item.LUs?lusData=lusData.concat(item.LUs):item&&item["Post Execution Processes"]&&(pepsData=pepsData.concat(item["Post Execution Processes"]))});for(var i=0;i<lusData.length;i++){var luData=lusData[i],luName=luData["LU Name"];luData["LU Migration Summary"]&&(migrateTableData=migrateTableData.concat(luData["LU Migration Summary"].map((function(data){return(data=Object.assign({"LU Name":luName},data)).added=data.added||0,data.updated=data.updated||0,data.unchanged=data.unchanged||0,data})))),referenceTableData=referenceTableData.concat(luData["LU Reference Summary"])}let pepsTableData=[];for(i=0;i<pepsData.length;i++){var pepData=pepsData[i],pepName=pepData["Process Name"];pepData["Process Summary"]&&(pepsTableData=pepsTableData.concat(pepData["Process Summary"].map((function(data){return data=Object.assign({"Process Summary":pepName},data)}))))}!function(migrateData,worksheet){if(addWorksheetTitle("Migrating summary report for Task Execution ID: "+generalInfo.task_execution_id,worksheet),addEmptyLine(worksheet),migrateData&&migrateData.length){var table=getTableModel(migrateData,worksheet,"migrateTable");if(table.columns&&table.columns.length){for(var i=0;i<table.rows[0];i++)table.rows[0][i].unshift(luName);table.columns.forEach(column=>{"start time"===column.name?column.name="start time (UTC)":"end time"===column.name&&(column.name="end time (UTC)")})}worksheet.addTable(table),addEmptyLine(worksheet)}else addWorksheetWarning("No entities were migrated",worksheet)}(migrateTableData,worksheet),addEmptyLine(worksheet),function(refData,worksheet){if(addWorksheetTitle("Execution Summary Report for Reference Tables",worksheet),addEmptyLine(worksheet),!refData||!refData.length)return void addWorksheetWarning("No Reference Tables",worksheet);const tableData=getTableModel(refData,worksheet,"referenceTableSummary");tableData&&tableData.columns&&tableData.columns.forEach(column=>{"end_time"===column.name?column.name="end_time (UTC)":"start_time"===column.name&&(column.name="start_time (UTC)")}),worksheet.addTable(tableData),addEmptyLine(worksheet)}(referenceTableData,worksheet),addEmptyLine(worksheet),function(pepData,worksheet){if(addWorksheetTitle("Post Execution Processes Summary",worksheet),addEmptyLine(worksheet),!pepData||!pepData.length)return void addWorksheetWarning("No Post Execution Processes Tables",worksheet);const tableData=getTableModel(pepData,worksheet,"pepTableSummary");tableData&&tableData.columns&&tableData.columns.forEach(column=>{"end_time"===column.name?column.name="end_time (UTC)":"start_time"===column.name&&(column.name="start_time (UTC)")}),worksheet.addTable(tableData),addEmptyLine(worksheet)}(pepsTableData,worksheet)}(worksheet,tabData);break;case"List of Root Entities":buildListOfRootEntitiesTab(worksheet,tabData);break;case"List of Reference Tables":buildListOfReferenceTables(worksheet,tabData);break;case"Error Summary":buildErrorSummaryTab(worksheet,tabData)}},buildLoadTab=function(tabName,tabData,worksheet){switch(tabName){case"General Info":buildGeneralInfoTab(worksheet);break;case"Task Execution Summary":!function(worksheet,tabData){if(!tabData||!tabData.length)return void addEmptyLine(worksheet);let luTableData=[],postExecutionProcessData=[];tabData.forEach(item=>{item&&item.LUs&&item.LUs["LU Load Summary"]?luTableData=luTableData.concat(item.LUs["LU Load Summary"]):item&&item["Post Execution Processes"]&&item["Post Execution Processes"]["Post Execution Processes Summary"]&&(postExecutionProcessData=postExecutionProcessData.concat(item["Post Execution Processes"]["Post Execution Processes Summary"]))}),addWorksheetTitle("LU Summary",worksheet),addEmptyLine(worksheet);let tableData=getTableModel(luTableData,worksheet,"loadExecutionSummary");tableData&&tableData.columns&&tableData.columns.forEach(column=>{"start_execution_time"===column.name?column.name="start_execution_time (UTC)":"end_execution_time"===column.name&&(column.name="end_execution_time (UTC)")}),worksheet.addTable(tableData),addEmptyLine(worksheet),postExecutionProcessData&&postExecutionProcessData.length>0&&(addWorksheetTitle("Post Execution Processes Summary",worksheet),addEmptyLine(worksheet),tableData=getTableModel(postExecutionProcessData,worksheet,"postExecutionSummary"),tableData&&tableData.columns&&tableData.columns.forEach(column=>{"start_execution_time"===column.name?column.name="start_execution_time (UTC)":"end_execution_time"===column.name&&(column.name="end_execution_time (UTC)")}),worksheet.addTable(tableData),addEmptyLine(worksheet))}(worksheet,tabData);break;case"List of Root Entities":buildListOfRootEntitiesTab(worksheet,tabData);break;case"List of Reference Tables":buildListOfReferenceTables(worksheet,tabData);break;case"Error Summary":buildErrorSummaryTab(worksheet,tabData);break;case"Statistics Report":!function(worksheet,tabData){tabData&&tabData.length?(worksheet.addTable(getTableModel(tabData,worksheet,"statisticsReportTable")),addEmptyLine(worksheet)):addWorksheetWarning("No Statistics Report Data",worksheet)}(worksheet,tabData);break;case"Replace Sequence Summary Report":!function(worksheet,tabData){tabData&&tabData.length?(worksheet.addTable(getTableModel(tabData,worksheet,"sequenceSummaryTable")),addEmptyLine(worksheet)):addWorksheetWarning("No Sequence Summary Report Data",worksheet)}(worksheet,tabData);break;case"Error Details":!function(worksheet,tabData){tabData&&tabData.length?(worksheet.addTable(getTableModel(tabData,worksheet,"errorDetailsTable")),addEmptyLine(worksheet)):addWorksheetWarning("No Error Details Report Data",worksheet)}(worksheet,tabData)}};return{buildSummaryExcel:function(data){var info,workbook=new ExcelJS.Workbook;return info=data["General Info"][0],generalInfo=info,function(workbook,data){var taskType=generalInfo.task_type.toLowerCase();Object.keys(data).forEach((function(tabName){var worksheet=workbook.addWorksheet(tabName),tabData=data[tabName];"extract"===taskType?buildExtractTab(tabName,tabData||{},worksheet):buildLoadTab(tabName,tabData||{},worksheet),(worksheet=>{if(worksheet.columns)for(let i=0;i<worksheet.columns.length;i+=1){let dataMax=0;const column=worksheet.columns[i];for(let j=1;column.values[j]&&j<column.values.length;j+=1){const columnLength=column.values[j].length;columnLength>dataMax&&(dataMax=columnLength)}column.width=dataMax<10?20:dataMax+20}})(worksheet)}))}(workbook,data),workbook}}}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL2J1aWxkRXhjZWwuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImZhY3RvcnkiLCJnZW5lcmFsSW5mb1N0cnVjdHVyZSIsIm5hbWUiLCJmaWVsZCIsInRhc2tfdHlwZSIsImdlbmVyYWxJbmZvIiwiYnVpbGRHZW5lcmFsSW5mb1RhYiIsIndvcmtzaGVldCIsImZvckVhY2giLCJ2YWx1ZSIsInRvTG93ZXJDYXNlIiwiYWRkUm93Iiwib3ZlcnJpZGVfcGFyYW1ldGVycyIsIkpTT04iLCJwYXJzZSIsIm92ZXJyaWRlUGFyYW1ldGVyc0tleXMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiYWRkRW1wdHlMaW5lIiwidGFza0dsb2JhbHMiLCJyZXNlcnZlUmV0ZW50aW9uUGVyaW9kIiwicmV0ZW50aW9uUGVyaW9kIiwia2V5IiwiZXJyIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwiZ2V0VGFibGVNb2RlbCIsImRhdGEiLCJ0YWJsZU5hbWUiLCJ0YWJsZUNvbHMiLCJ0YWJsZVJvd3MiLCJjdXJyZW50Um93IiwicHVzaCIsIndpZHRoIiwiaSIsInRhYmxlUm93Iiwicm93IiwicmVmIiwiX2NlbGxzIiwiX2FkZHJlc3MiLCJjb2x1bW5zIiwicm93cyIsInN0eWxlIiwiYWRkQ3VzdG9taXplZFJvdyIsInRleHQiLCJjdXN0b21TdHlsZSIsInN0eWxlQXR0ciIsImFkZFdvcmtzaGVldFRpdGxlIiwidGl0bGVOYW1lIiwiZm9udCIsImJvbGQiLCJzaXplIiwiYWRkV29ya3NoZWV0V2FybmluZyIsIm1lc3NhZ2UiLCJjb2xvciIsImFyZ2IiLCJidWlsZExpc3RPZlJvb3RFbnRpdGllc1RhYiIsInRhYkRhdGEiLCJudW1PZkNvcGllZEVudGl0aWVzIiwibnVtYmVyX29mX2NvcGllZF9yb290X2VudGl0aWVzIiwibGlzdE9mQ29waWVkRW50aXRpZXMiLCJudW1PZkZhaWxlZEVudGl0aWVzIiwibnVtYmVyX29mX2ZhaWxlZF9yb290X2VudGl0aWVzIiwibGlzdE9mRmFpbGVkRW50aXRpZXMiLCJiZV9uYW1lIiwiYWRkVGFibGUiLCJhZGRDb3BpZWRFbnRpdGllc1RhYmxlIiwiYWRkRmFpbGVkRW50aXRpZXNUYWJsZSIsImJ1aWxkTGlzdE9mUmVmZXJlbmNlVGFibGVzIiwiY291bnQiLCJhZGRDb3BpZWRSZWZUYWJsZSIsImFkZEZhaWxlZFJlZlRhYmxlIiwiYnVpbGRFcnJvclN1bW1hcnlUYWIiLCJidWlsZEV4dHJhY3RUYWIiLCJ0YWJOYW1lIiwibWlncmF0ZVRhYmxlRGF0YSIsInJlZmVyZW5jZVRhYmxlRGF0YSIsImx1c0RhdGEiLCJwZXBzRGF0YSIsIml0ZW0iLCJMVXMiLCJjb25jYXQiLCJsdURhdGEiLCJsdU5hbWUiLCJtYXAiLCJhc3NpZ24iLCJMVSBOYW1lIiwiYWRkZWQiLCJ1cGRhdGVkIiwidW5jaGFuZ2VkIiwicGVwc1RhYmxlRGF0YSIsInBlcERhdGEiLCJwZXBOYW1lIiwiUHJvY2VzcyBTdW1tYXJ5IiwibWlncmF0ZURhdGEiLCJ0YXNrX2V4ZWN1dGlvbl9pZCIsInRhYmxlIiwidW5zaGlmdCIsImNvbHVtbiIsImFkZE1pZ3JhdGVUYWJsZSIsInJlZkRhdGEiLCJ0YWJsZURhdGEiLCJhZGRSZWZlcmVuY2VUYWJsZSIsImFkZFBvc3RFeGVjdXRpb25UYWJsZSIsImJ1aWxkRXh0cmFjdFRhc2tFeGVjdXRpb25TdW1tYXJ5IiwiYnVpbGRMb2FkVGFiIiwibHVUYWJsZURhdGEiLCJwb3N0RXhlY3V0aW9uUHJvY2Vzc0RhdGEiLCJidWlsZExvYWRUYXNrRXhlY3V0aW9uU3VtbWFyeSIsImJ1aWxkU3RhdGlzdGljc1JlcG9ydFRhYiIsImJ1aWxkU2VxdWVuY2VTdW1tYXJ5VGFiIiwiYnVpbGRFcnJvckRldGFpbHNUYWIiLCJidWlsZFN1bW1hcnlFeGNlbCIsImluZm8iLCJ3b3JrYm9vayIsIkV4Y2VsSlMiLCJXb3JrYm9vayIsInRhc2tUeXBlIiwiYWRkV29ya3NoZWV0IiwiZGF0YU1heCIsImoiLCJ2YWx1ZXMiLCJjb2x1bW5MZW5n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QyxTQUFXLElBQUlDLFFBQVFDLFNBRzNCLE9BempCMkJILEtBdWpCWnRGLEtBQUssZ0JBQWdCLEdBdGpCcEN4QixZQUFjOEcsS0F3aUJBLFNBQVVDLFNBQVV2RixNQUNsQyxJQUFJMEYsU0FBV2xILFlBQVlELFVBQVVNLGNBQ3JDTSxPQUFPQyxLQUFLWSxNQUFNckIsU0FBUSxTQUFVb0UsU0FDaEMsSUFBSXJFLFVBQVk2RyxTQUFTSSxhQUFhNUMsU0FDbENqQixRQUFVOUIsS0FBSytDLFNBQ04sWUFBYjJDLFNBQXlCNUMsZ0JBQWdCQyxRQUFTakIsU0FBVyxHQUFJcEQsV0FBYW9HLGFBQWEvQixRQUFTakIsU0FBVyxHQUFJcEQsV0F0QnpGQSxDQUFBQSxZQUM5QixHQUFLQSxVQUFVbUMsUUFHZixJQUFLLElBQUlOLEVBQUksRUFBR0EsRUFBSTdCLFVBQVVtQyxRQUFReEIsT0FBUWtCLEdBQUssRUFBRyxDQUNsRCxJQUFJcUYsUUFBVSxFQUNkLE1BQU1yQixPQUFTN0YsVUFBVW1DLFFBQVFOLEdBQ2pDLElBQUssSUFBSXNGLEVBQUksRUFBR3RCLE9BQU91QixPQUFPRCxJQUFNQSxFQUFJdEIsT0FBT3VCLE9BQU96RyxPQUFRd0csR0FBSyxFQUFHLENBQ2xFLE1BQU1FLGFBQWV4QixPQUFPdUIsT0FBT0QsR0FBR3hHLE9BQ2xDMEcsYUFBZUgsVUFDZkEsUUFBVUcsY0FHbEJ4QixPQUFPakUsTUFBUXNGLFFBQVUsR0FBSyxHQUFLQSxRQUFVLEtBVzdDSSxDQUE0QnRILGNBUWhDdUgsQ0FBV1YsU0FBVXZGLE1BQ2R1RiIsImZpbGUiOiJzZXJ2aWNlcy9idWlsZEV4Y2VsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ1RETS1GRScpXG5cblxuICAgIC5mYWN0b3J5KCdFeGNlbFNlcnZpY2UnLCBmdW5jdGlvbiAoKSB7XG5cblxuICAgICAgICB2YXIgZ2VuZXJhbEluZm9TdHJ1Y3R1cmUgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJUYXNrIE5hbWVcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJ0YXNrX25hbWVcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJUYXNrIElEXCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwidGFza19pZFwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJhbGxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlRhc2sgRXhlY3V0aW9uIElEXCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwidGFza19leGVjdXRpb25faWRcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJDcmVhdGVkIGJ5XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiY3JlYXRlZF9ieVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJhbGxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIkV4ZWN1dGVkIEJ5XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiZXhlY3V0ZWRfYnlcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJFeGVjdXRpb24gVGltZSAoVVRDKVwiLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcInN0YXJ0X2V4ZWN1dGlvblwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJhbGxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIkV4ZWN1dGlvbiBTdGF0dXNcIiwgLy8gbWlzc2luZ1xuICAgICAgICAgICAgICAgIGZpZWxkOiBcImV4ZWN1dGlvbl9zdGF0dXNcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJTb3VyY2UgRW52aXJvbm1lbnRcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJzb3VyY2VfZW52XCIsXG4gICAgICAgICAgICAgICAgdGFza190eXBlOiBcImFsbFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiVGFyZ2V0IEVudmlyb25tZW50XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwidGFyZ2V0X2VudlwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJsb2FkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJCdXNpbmVzcyBFbnRpdHkgTmFtZVwiLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcImJlX25hbWVcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJUYXNrIFByb3BlcnRpZXM6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiXCIsXG4gICAgICAgICAgICAgICAgdGFza190eXBlOiBcImFsbFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiVGFzayBUeXBlOlwiLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcInRhc2tfdHlwZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJhbGxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIkZhYnJpYyBFeGVjdXRpb24gSWQ6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwiZmFicmljX2V4ZWN1dGlvbl9pZFwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJhbGxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlNlbGVjdGlvbiBNZXRob2Q6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwic2VsZWN0aW9uX21ldGhvZFwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJsb2FkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJUYXNrIFN5bmMgTW9kZTpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJ0YXNrX3N5bmNfbW9kZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJsb2FkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJFbnYgU3luYyBNb2RlOlwiLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcImVudl9zeW5jX21vZGVcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwibG9hZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiT3BlcmF0aW9uIE1vZGU6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwib3BlcmF0aW9uX21vZGVcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwibG9hZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiUmVwbGFjZSBTZXF1ZW5jZXM6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwicmVwbGFjZV9zZXF1ZW5jZXNcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwibG9hZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiVGFzayBWZXJzaW9uaW5nOlwiLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcInZlcnNpb25faW5kXCIsXG4gICAgICAgICAgICAgICAgdGFza190eXBlOiBcImFsbFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiU2VsZWN0ZWQgVmVyc2lvbiBOYW1lIGZvciBFbnRpdGllczpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJzZWxlY3RlZF92ZXJzaW9uX3Rhc2tfbmFtZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJsb2FkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJTZWxlY3RlZCBWZXJzaW9uIERhdGV0aW1lIGZvciBFbnRpdGllczpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJzZWxlY3RlZF92ZXJzaW9uX2RhdGV0aW1lXCIsXG4gICAgICAgICAgICAgICAgdGFza190eXBlOiBcImxvYWRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlNlbGVjdGVkIFZlcnNpb24gTmFtZSBmb3IgUmVmZXJlbmNlIFRhYmxlczpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJzZWxlY3RlZF9yZWZfdmVyc2lvbl90YXNrX25hbWVcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwibG9hZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiU2VsZWN0ZWQgVmVyc2lvbiBEYXRldGltZSBmb3IgUmVmZXJlbmNlIFRhYmxlczpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJzZWxlY3RlZF9yZWZfdmVyc2lvbl9kYXRldGltZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJsb2FkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJTY2hlZHVsaW5nIFBhcmFtZXRlcnM6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwidmVyc2lvbl9pbmRcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwibG9hZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiU2NoZWR1bGUgRXhwaXJhdGlvbiBEYXRlOlwiLFxuICAgICAgICAgICAgICAgIGZpZWxkOiBcInNjaGVkdWxlX2V4cGlyYXRpb25fZGF0ZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJsb2FkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJWZXJzaW9uIEV4cGlyYXRpb24gRGF0ZTpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJ2ZXJzaW9uX2V4cGlyYXRpb25fZGF0ZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJleHRyYWN0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJSZXRlbnRpb24gUGVyaW9kIFR5cGU6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwicmV0ZW50aW9uX3BlcmlvZF90eXBlXCIsXG4gICAgICAgICAgICAgICAgdGFza190eXBlOiBcImV4dHJhY3RcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlJldGVudGlvbiBQZXJpb2QgVmFsdWU6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwicmV0ZW50aW9uX3BlcmlvZF92YWx1ZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJleHRyYWN0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJSZXNlcnZhdGlvbiBJbmRpY2F0b3I6XCIsXG4gICAgICAgICAgICAgICAgZmllbGQ6IFwicmVzZXJ2ZV9pbmRcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJSZXNlcnZhdGlvbiBQZXJpb2QgVHlwZTpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJyZXNlcnZlX3JldGVudGlvbl9wZXJpb2RfdHlwZVwiLFxuICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogXCJhbGxcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlJlc2VydmF0aW9uIFBlcmlvZCBWYWx1ZTpcIixcbiAgICAgICAgICAgICAgICBmaWVsZDogXCJyZXNlcnZlX3JldGVudGlvbl9wZXJpb2RfdmFsdWVcIixcbiAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IFwiYWxsXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgICAgdmFyIGdlbmVyYWxJbmZvID0ge307XG4gICAgICAgIFxuICAgICAgICB2YXIgc2V0R2VuZXJhbEluZm8gPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgICAgZ2VuZXJhbEluZm8gPSBpbmZvO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdmFyIGJ1aWxkR2VuZXJhbEluZm9UYWIgPSBmdW5jdGlvbiAod29ya3NoZWV0KSB7XG4gICAgICAgICAgICB2YXIgdGFza190eXBlID0gZ2VuZXJhbEluZm8udGFza190eXBlO1xuICAgICAgICAgICAgZ2VuZXJhbEluZm9TdHJ1Y3R1cmUuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBnZW5lcmFsSW5mb1tmaWVsZC5maWVsZF0gfHwgJyc7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLmZpZWxkID09PSAnZmFicmljX2V4ZWN1dGlvbl9pZCcgJiYgIWdlbmVyYWxJbmZvW2ZpZWxkLmZpZWxkXSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLnRhc2tfdHlwZSA9PT0gJ2FsbCcgfHxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQudGFza190eXBlID09PSB0YXNrX3R5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkUm93KFtmaWVsZC5uYW1lLCAnJyArIHZhbHVlXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChnZW5lcmFsSW5mby5vdmVycmlkZV9wYXJhbWV0ZXJzKXtcbiAgICAgICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJyaWRlX3BhcmFtZXRlcnMgPSBKU09OLnBhcnNlKGdlbmVyYWxJbmZvLm92ZXJyaWRlX3BhcmFtZXRlcnMpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdmVycmlkZVBhcmFtZXRlcnNLZXlzID0gIE9iamVjdC5rZXlzKG92ZXJyaWRlX3BhcmFtZXRlcnMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3ZlcnJpZGVQYXJhbWV0ZXJzS2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldC5hZGRSb3coWydPdmVycmlkZSBQYXJhbWV0ZXJzJ10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRhc2tHbG9iYWxzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXNlcnZlUmV0ZW50aW9uUGVyaW9kID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXRlbnRpb25QZXJpb2QgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVQYXJhbWV0ZXJzS2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ1RBU0tfR0xPQkFMUycpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrR2xvYmFscyA9IG92ZXJyaWRlX3BhcmFtZXRlcnNba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnUkVTRVJWRV9SRVRFTlRJT05fUEFSQU1TJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlUmV0ZW50aW9uUGVyaW9kID0gb3ZlcnJpZGVfcGFyYW1ldGVyc1trZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdEQVRBRkxVWF9SRVRFTlRJT05fUEFSQU1TJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRlbnRpb25QZXJpb2QgPSBvdmVycmlkZV9wYXJhbWV0ZXJzW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0LmFkZFJvdyhba2V5LCAnJyArIG92ZXJyaWRlX3BhcmFtZXRlcnNba2V5XV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tHbG9iYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0LmFkZFJvdyhbJ1Rhc2sgR2xvYmFscyddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh0YXNrR2xvYmFscykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkUm93KFtrZXksICcnICsgdGFza0dsb2JhbHNba2V5XV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmVSZXRlbnRpb25QZXJpb2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkUm93KFsnUkVTRVJWRSBSRVRFTlRJT04gUEFSQU1TJ10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHJlc2VydmVSZXRlbnRpb25QZXJpb2QpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0LmFkZFJvdyhba2V5LCAnJyArIHJlc2VydmVSZXRlbnRpb25QZXJpb2Rba2V5XV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldGVudGlvblBlcmlvZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEVtcHR5TGluZSh3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldC5hZGRSb3coWydSRVRFTlRJT04gUEVSSU9EIFBBUkFNUyddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhyZXRlbnRpb25QZXJpb2QpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0LmFkZFJvdyhba2V5LCAnJyArIHJldGVudGlvblBlcmlvZFtrZXldXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9Y2F0Y2ggKGVycil7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1bmFibGUgdG8gcGFyc2Ugb3ZlcnJpZGUgcGFyYW1ldGVycycpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdmFyIGFkZEVtcHR5TGluZSA9IGZ1bmN0aW9uICh3b3Jrc2hlZXQpIHtcbiAgICAgICAgICAgIHdvcmtzaGVldC5hZGRSb3coWycnXSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogQHBhcmFtIGRhdGEgLSBBcnJheSBvZiBlbnRyaWVzIHRvIGJ1aWxkIHRoZSB0YWJsZVxuICAgICAgICAgKiBAcGFyYW0gd29ya3NoZWV0XG4gICAgICAgICAqIEByZXR1cm5zIHt7cmVmOiAqLCBjb2x1bW5zOiBbXSwgc3R5bGU6IHtzaG93Rmlyc3RDb2x1bW46IGJvb2xlYW4sIHRoZW1lOiBzdHJpbmd9LCByb3dzOiBbXX19IC0gVGFibGUgTW9kZWxcbiAgICAgICAgICovXG4gICAgICAgIHZhciBnZXRUYWJsZU1vZGVsID0gZnVuY3Rpb24gKGRhdGEsIHdvcmtzaGVldCwgdGFibGVOYW1lKSB7XG4gICAgICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgICAgIHZhciB0YWJsZUNvbHMgPSBbXTtcbiAgICAgICAgICAgIHZhciB0YWJsZVJvd3MgPSBbXTtcbiAgICAgICAgXG4gICAgICAgICAgICAvLyByZWZlcmVuY2UgdG8gbmV4dCBsaW5lIHRvIGluZGljYXRlIHRoZSBjdXJyZW50IGNlbGwgbmFtZSBpbiBvcmRlciB0byBwYXNzIGl0IGZvciB0aGUgdGFibGUgbW9kZWwgYXMgYSByZWZcbiAgICAgICAgICAgIHZhciBjdXJyZW50Um93ID0gd29ya3NoZWV0LmFkZFJvdyhbJyddKTtcbiAgICAgICAgXG4gICAgICAgICAgICB2YXIgZ2V0Q29sdW1uU3R5bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZm9udDoge2JvbGQ6IHRydWV9LFxuICAgICAgICAgICAgICAgICAgICBib3JkZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDoge3N0eWxlOiAnbWVkaXVtJ30sXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB7c3R5bGU6ICdtZWRpdW0nfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbToge3N0eWxlOiAnbWVkaXVtJ30sXG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodDoge3N0eWxlOiAnbWVkaXVtJ31cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAgICAgLy8gZ2VuZXJhdGUgY29sdW1ucyBiYXNlZCBvbiBmaXJzdCBkYXRhIGVudHJ5IGtleXMgbmFtZXNcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGRhdGFbMF0pLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgICAgIHRhYmxlQ29scy5wdXNoKHtuYW1lOiBrZXksIGtleToga2V5LCB3aWR0aDogJzc3J30pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL2dlbmVyYXRlIHJvd3MgYmFzZWQgb24gZW50cmllc1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhYmxlUm93ID0gW107XG4gICAgICAgICAgICAgICAgdmFyIHJvdyA9IGRhdGFbaV07XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocm93KS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFibGVSb3cucHVzaChyb3dba2V5XSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0YWJsZVJvd3MucHVzaCh0YWJsZVJvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgcmVmOiBjdXJyZW50Um93Ll9jZWxsc1swXS5fYWRkcmVzcyxcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiB0YWJsZUNvbHMsXG4gICAgICAgICAgICAgICAgcm93czogdGFibGVSb3dzLFxuICAgICAgICAgICAgICAgIHN0eWxlOiB7fVxuICAgICAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYWRkQ3VzdG9taXplZFJvdyA9IGZ1bmN0aW9uICh0ZXh0LCB3b3Jrc2hlZXQsIGN1c3RvbVN0eWxlKSB7XG4gICAgICAgICAgICB2YXIgcm93ID0gd29ya3NoZWV0LmFkZFJvdyhbdGV4dF0pO1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoY3VzdG9tU3R5bGUpLmZvckVhY2goZnVuY3Rpb24gKHN0eWxlQXR0cikge1xuICAgICAgICAgICAgICAgIHJvd1tzdHlsZUF0dHJdID0gY3VzdG9tU3R5bGVbc3R5bGVBdHRyXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdmFyIGFkZFdvcmtzaGVldE5vdGUgPSBmdW5jdGlvbiAobm90ZSwgd29ya3NoZWV0KSB7XG4gICAgICAgICAgICB2YXIgY3VzdG9tU3R5bGUgPSB7XG4gICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjoge2FyZ2I6ICdGRjhDMDAnfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhZGRDdXN0b21pemVkUm93KG5vdGUsIHdvcmtzaGVldCwgY3VzdG9tU3R5bGUpXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYWRkV29ya3NoZWV0VGl0bGUgPSBmdW5jdGlvbiAodGl0bGVOYW1lLCB3b3Jrc2hlZXQpIHtcbiAgICAgICAgICAgIHZhciBjdXN0b21TdHlsZSA9IHtcbiAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IDE0XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGFkZEN1c3RvbWl6ZWRSb3codGl0bGVOYW1lLCB3b3Jrc2hlZXQsIGN1c3RvbVN0eWxlKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBhZGRXb3Jrc2hlZXRXYXJuaW5nID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdvcmtzaGVldCkge1xuICAgICAgICAgICAgdmFyIGN1c3RvbVN0eWxlID0ge1xuICAgICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHthcmdiOiAnRkYwMDAwJ31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYWRkQ3VzdG9taXplZFJvdyhtZXNzYWdlLCB3b3Jrc2hlZXQsIGN1c3RvbVN0eWxlKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBidWlsZExvYWRUYXNrRXhlY3V0aW9uU3VtbWFyeSA9IGZ1bmN0aW9uICh3b3Jrc2hlZXQsIHRhYkRhdGEpIHtcbiAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXRhYkRhdGEgfHwgIXRhYkRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGx1VGFibGVEYXRhID0gW107XG4gICAgICAgICAgICBsZXQgcG9zdEV4ZWN1dGlvblByb2Nlc3NEYXRhID0gW107XG5cbiAgICAgICAgICAgIHRhYkRhdGEuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSAmJiBcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5MVXMgJiYgXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uTFVzWydMVSBMb2FkIFN1bW1hcnknXSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsdVRhYmxlRGF0YSA9IGx1VGFibGVEYXRhLmNvbmNhdChpdGVtLkxVc1snTFUgTG9hZCBTdW1tYXJ5J10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtICYmIFxuICAgICAgICAgICAgICAgICAgICBpdGVtWydQb3N0IEV4ZWN1dGlvbiBQcm9jZXNzZXMnXSAmJiBcbiAgICAgICAgICAgICAgICAgICAgaXRlbVsnUG9zdCBFeGVjdXRpb24gUHJvY2Vzc2VzJ11bJ1Bvc3QgRXhlY3V0aW9uIFByb2Nlc3NlcyBTdW1tYXJ5J10peyBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RFeGVjdXRpb25Qcm9jZXNzRGF0YSA9IHBvc3RFeGVjdXRpb25Qcm9jZXNzRGF0YS5jb25jYXQoaXRlbVsnUG9zdCBFeGVjdXRpb24gUHJvY2Vzc2VzJ11bJ1Bvc3QgRXhlY3V0aW9uIFByb2Nlc3NlcyBTdW1tYXJ5J10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhZGRXb3Jrc2hlZXRUaXRsZSgnTFUgU3VtbWFyeScsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHRhYmxlRGF0YSA9IGdldFRhYmxlTW9kZWwobHVUYWJsZURhdGEsIHdvcmtzaGVldCwgJ2xvYWRFeGVjdXRpb25TdW1tYXJ5Jyk7XG4gICAgICAgICAgICBpZiAodGFibGVEYXRhICYmIHRhYmxlRGF0YS5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgdGFibGVEYXRhLmNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uLm5hbWUgPT09ICdzdGFydF9leGVjdXRpb25fdGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5uYW1lID0gJ3N0YXJ0X2V4ZWN1dGlvbl90aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb2x1bW4ubmFtZSA9PT0gJ2VuZF9leGVjdXRpb25fdGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5uYW1lID0gJ2VuZF9leGVjdXRpb25fdGltZSAoVVRDKSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdvcmtzaGVldC5hZGRUYWJsZSh0YWJsZURhdGEpO1xuICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChwb3N0RXhlY3V0aW9uUHJvY2Vzc0RhdGEgJiYgcG9zdEV4ZWN1dGlvblByb2Nlc3NEYXRhLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgIGFkZFdvcmtzaGVldFRpdGxlKCdQb3N0IEV4ZWN1dGlvbiBQcm9jZXNzZXMgU3VtbWFyeScsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB0YWJsZURhdGEgPSBnZXRUYWJsZU1vZGVsKHBvc3RFeGVjdXRpb25Qcm9jZXNzRGF0YSwgd29ya3NoZWV0LCAncG9zdEV4ZWN1dGlvblN1bW1hcnknKTtcbiAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhICYmIHRhYmxlRGF0YS5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YS5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW4ubmFtZSA9PT0gJ3N0YXJ0X2V4ZWN1dGlvbl90aW1lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5uYW1lID0gJ3N0YXJ0X2V4ZWN1dGlvbl90aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbHVtbi5uYW1lID09PSAnZW5kX2V4ZWN1dGlvbl90aW1lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5uYW1lID0gJ2VuZF9leGVjdXRpb25fdGltZSAoVVRDKSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUodGFibGVEYXRhKTtcbiAgICBcbiAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBidWlsZEV4dHJhY3RUYXNrRXhlY3V0aW9uU3VtbWFyeSA9IGZ1bmN0aW9uICh3b3Jrc2hlZXQsIHRhYkRhdGEpIHtcbiAgICAgICAgICAgIHZhciBtaWdyYXRlVGFibGVEYXRhID0gW107XG4gICAgICAgICAgICB2YXIgcmVmZXJlbmNlVGFibGVEYXRhID0gW107XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxldCBsdXNEYXRhID0gW107XG4gICAgICAgICAgICBsZXQgcGVwc0RhdGEgPSBbXTtcbiAgICAgICAgICAgIHRhYkRhdGEuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSAmJiBcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5MVXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgbHVzRGF0YSA9IGx1c0RhdGEuY29uY2F0KGl0ZW0uTFVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSAmJiBcbiAgICAgICAgICAgICAgICAgICAgaXRlbVsnUG9zdCBFeGVjdXRpb24gUHJvY2Vzc2VzJ10peyBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcHNEYXRhID0gcGVwc0RhdGEuY29uY2F0KGl0ZW1bJ1Bvc3QgRXhlY3V0aW9uIFByb2Nlc3NlcyddKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vZ2VuZXJhdGUgbWlncmF0ZSB0YWJsZSBkYXRhIGFuZCBhdHRhY2ggbHUgbmFtZSB0byByb3dzLCBhbmQgbWlzc2luZyAzIGZpZWxkcyBmcm9tIHRoZSBmYWJyaWMgKGFzIGRpc2N1c3NlZClcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbHVzRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBsdURhdGEgPSBsdXNEYXRhW2ldO1xuICAgICAgICAgICAgICAgIHZhciBsdU5hbWUgPSBsdURhdGFbJ0xVIE5hbWUnXTtcbiAgICAgICAgICAgICAgICBpZiAobHVEYXRhWydMVSBNaWdyYXRpb24gU3VtbWFyeSddKSB7XG4gICAgICAgICAgICAgICAgICAgIG1pZ3JhdGVUYWJsZURhdGEgPSBtaWdyYXRlVGFibGVEYXRhLmNvbmNhdChsdURhdGFbJ0xVIE1pZ3JhdGlvbiBTdW1tYXJ5J10ubWFwKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gT2JqZWN0LmFzc2lnbih7J0xVIE5hbWUnOiBsdU5hbWV9LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIGRpc2N1c3NlZCB3aXRoIFRhaGEsIGN1cnJlbnRseSwgd2Ugd2lsbCBhZGQgdGhlc2UgMyBtaXNzaW5nIGZpZWxkcyBmb3Igcm93cyB3aGljaCBoYXMgbm8gbWlncmF0aW9uIGJlY2F1c2UgdGhlIGZhYnJpYyBkb2VzIG5vdCByZXR1cm4gdGhlbS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWRkZWQgPSBkYXRhLmFkZGVkIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnVwZGF0ZWQgPSBkYXRhLnVwZGF0ZWQgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudW5jaGFuZ2VkID0gZGF0YS51bmNoYW5nZWQgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZVRhYmxlRGF0YSA9IHJlZmVyZW5jZVRhYmxlRGF0YS5jb25jYXQobHVEYXRhWydMVSBSZWZlcmVuY2UgU3VtbWFyeSddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBwZXBzVGFibGVEYXRhID0gW107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGVwc0RhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVwRGF0YSA9IHBlcHNEYXRhW2ldO1xuICAgICAgICAgICAgICAgIHZhciBwZXBOYW1lID0gcGVwRGF0YVsnUHJvY2VzcyBOYW1lJ107XG4gICAgICAgICAgICAgICAgaWYgKHBlcERhdGFbJ1Byb2Nlc3MgU3VtbWFyeSddKSB7XG4gICAgICAgICAgICAgICAgICAgIHBlcHNUYWJsZURhdGEgPSBwZXBzVGFibGVEYXRhLmNvbmNhdChwZXBEYXRhWydQcm9jZXNzIFN1bW1hcnknXS5tYXAoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBPYmplY3QuYXNzaWduKHsnUHJvY2VzcyBTdW1tYXJ5JzogcGVwTmFtZX0sIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXMgZGlzY3Vzc2VkIHdpdGggVGFoYSwgY3VycmVudGx5LCB3ZSB3aWxsIGFkZCB0aGVzZSAzIG1pc3NpbmcgZmllbGRzIGZvciByb3dzIHdoaWNoIGhhcyBubyBtaWdyYXRpb24gYmVjYXVzZSB0aGUgZmFicmljIGRvZXMgbm90IHJldHVybiB0aGVtLlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgdmFyIGFkZE1pZ3JhdGVUYWJsZSA9IGZ1bmN0aW9uIChtaWdyYXRlRGF0YSwgd29ya3NoZWV0KSB7XG4gICAgICAgICAgICAgICAgYWRkV29ya3NoZWV0VGl0bGUoJ01pZ3JhdGluZyBzdW1tYXJ5IHJlcG9ydCBmb3IgVGFzayBFeGVjdXRpb24gSUQ6ICcgKyBnZW5lcmFsSW5mby50YXNrX2V4ZWN1dGlvbl9pZCwgd29ya3NoZWV0KTtcbiAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKCFtaWdyYXRlRGF0YSB8fCAhbWlncmF0ZURhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZFdvcmtzaGVldFdhcm5pbmcoJ05vIGVudGl0aWVzIHdlcmUgbWlncmF0ZWQnLCB3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9IGdldFRhYmxlTW9kZWwobWlncmF0ZURhdGEsIHdvcmtzaGVldCwgJ21pZ3JhdGVUYWJsZScpO1xuICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodGFibGUuY29sdW1ucyAmJiB0YWJsZS5jb2x1bW5zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjdXN0b21pemUgdGFibGUgdG8gYWRkIGxvZ2ljYWwgdW5pdCBuYW1lIGFzIHRoZSBmaXJzdCBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIC8vIHB1c2ggbHUgbmFtZSBhcyBmaXJzdCBjb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsZS5yb3dzWzBdOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnJvd3NbMF1baV0udW5zaGlmdChsdU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbi5uYW1lID09PSAnc3RhcnQgdGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4ubmFtZSA9ICdzdGFydCB0aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbHVtbi5uYW1lID09PSAnZW5kIHRpbWUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLm5hbWUgPSAnZW5kIHRpbWUgKFVUQyknO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIHdvcmtzaGVldC5hZGRUYWJsZSh0YWJsZSk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICAgICB2YXIgYWRkUmVmZXJlbmNlVGFibGUgPSBmdW5jdGlvbiAocmVmRGF0YSwgd29ya3NoZWV0KSB7XG4gICAgICAgICAgICAgICAgYWRkV29ya3NoZWV0VGl0bGUoJ0V4ZWN1dGlvbiBTdW1tYXJ5IFJlcG9ydCBmb3IgUmVmZXJlbmNlIFRhYmxlcycsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICghcmVmRGF0YSB8fCAhcmVmRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkV29ya3NoZWV0V2FybmluZygnTm8gUmVmZXJlbmNlIFRhYmxlcycsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdGFibGVEYXRhID0gZ2V0VGFibGVNb2RlbChyZWZEYXRhLCB3b3Jrc2hlZXQsICdyZWZlcmVuY2VUYWJsZVN1bW1hcnknKTtcbiAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhICYmIHRhYmxlRGF0YS5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YS5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW4ubmFtZSA9PT0gJ2VuZF90aW1lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5uYW1lID0gJ2VuZF90aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbHVtbi5uYW1lID09PSAnc3RhcnRfdGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4ubmFtZSA9ICdzdGFydF90aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgd29ya3NoZWV0LmFkZFRhYmxlKHRhYmxlRGF0YSk7XG5cbiAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgYWRkUG9zdEV4ZWN1dGlvblRhYmxlID0gZnVuY3Rpb24gKHBlcERhdGEsIHdvcmtzaGVldCkge1xuICAgICAgICAgICAgICAgIGFkZFdvcmtzaGVldFRpdGxlKCdQb3N0IEV4ZWN1dGlvbiBQcm9jZXNzZXMgU3VtbWFyeScsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICghcGVwRGF0YSB8fCAhcGVwRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkV29ya3NoZWV0V2FybmluZygnTm8gUG9zdCBFeGVjdXRpb24gUHJvY2Vzc2VzIFRhYmxlcycsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdGFibGVEYXRhID0gZ2V0VGFibGVNb2RlbChwZXBEYXRhLCB3b3Jrc2hlZXQsICdwZXBUYWJsZVN1bW1hcnknKTtcbiAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhICYmIHRhYmxlRGF0YS5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YS5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW4ubmFtZSA9PT0gJ2VuZF90aW1lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5uYW1lID0gJ2VuZF90aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbHVtbi5uYW1lID09PSAnc3RhcnRfdGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4ubmFtZSA9ICdzdGFydF90aW1lIChVVEMpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgd29ya3NoZWV0LmFkZFRhYmxlKHRhYmxlRGF0YSk7XG5cbiAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgXG4gICAgICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgICAgIGFkZE1pZ3JhdGVUYWJsZShtaWdyYXRlVGFibGVEYXRhLCB3b3Jrc2hlZXQpO1xuICAgICAgICBcbiAgICAgICAgICAgIGFkZEVtcHR5TGluZSh3b3Jrc2hlZXQpO1xuICAgICAgICBcbiAgICAgICAgICAgIGFkZFJlZmVyZW5jZVRhYmxlKHJlZmVyZW5jZVRhYmxlRGF0YSwgd29ya3NoZWV0KTtcblxuICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgYWRkUG9zdEV4ZWN1dGlvblRhYmxlKHBlcHNUYWJsZURhdGEsIHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdmFyIGJ1aWxkTGlzdE9mUm9vdEVudGl0aWVzVGFiID0gZnVuY3Rpb24gKHdvcmtzaGVldCwgdGFiRGF0YSkge1xuICAgICAgICAgICAgdmFyIG51bU9mQ29waWVkRW50aXRpZXMgPSB0YWJEYXRhWydOdW1iZXIgb2YgQ29waWVkIEVudGl0aWVzJ11bMF0ubnVtYmVyX29mX2NvcGllZF9yb290X2VudGl0aWVzO1xuICAgICAgICAgICAgdmFyIGxpc3RPZkNvcGllZEVudGl0aWVzID0gdGFiRGF0YVsnTGlzdCBvZiBDb3BpZWQgRW50aXRpZXMnXTtcbiAgICAgICAgICAgIHZhciBudW1PZkZhaWxlZEVudGl0aWVzID0gdGFiRGF0YVsnTnVtYmVyIG9mIEZhaWxlZCBFbnRpdGllcyddWzBdLm51bWJlcl9vZl9mYWlsZWRfcm9vdF9lbnRpdGllcztcbiAgICAgICAgICAgIHZhciBsaXN0T2ZGYWlsZWRFbnRpdGllcyA9IHRhYkRhdGFbJ0xpc3Qgb2YgRmFpbGVkIEVudGl0aWVzJ107XG4gICAgICAgIFxuICAgICAgICAgICAgdmFyIGFkZENvcGllZEVudGl0aWVzVGFibGUgPSBmdW5jdGlvbiAobnVtT2ZDb3BpZWRFbnRpdGllcywgbGlzdE9mQ29waWVkRW50aXRpZXMpIHtcbiAgICAgICAgICAgICAgICBhZGRXb3Jrc2hlZXRUaXRsZSgnTnVtYmVyIG9mICcgKyBnZW5lcmFsSW5mby5iZV9uYW1lICsgJyBDb3BpZWQgZW50aXRpZXM6JyArIG51bU9mQ29waWVkRW50aXRpZXMsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChudW1PZkNvcGllZEVudGl0aWVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUoZ2V0VGFibGVNb2RlbChsaXN0T2ZDb3BpZWRFbnRpdGllcywgd29ya3NoZWV0LCAnY29waWVkRW50aXRpZXNUYWJsZScpKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAgICAgdmFyIGFkZEZhaWxlZEVudGl0aWVzVGFibGUgPSBmdW5jdGlvbiAobnVtT2ZGYWlsZWRFbnRpdGllcywgbGlzdE9mRmFpbGVkRW50aXRpZXMpIHtcbiAgICAgICAgICAgICAgICBhZGRXb3Jrc2hlZXRUaXRsZSgnTnVtYmVyIG9mICcgKyBnZW5lcmFsSW5mby5iZV9uYW1lICsgJyBGYWlsZWQgZW50aXRpZXM6JyArIG51bU9mRmFpbGVkRW50aXRpZXMsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChudW1PZkZhaWxlZEVudGl0aWVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUoZ2V0VGFibGVNb2RlbChsaXN0T2ZGYWlsZWRFbnRpdGllcywgd29ya3NoZWV0LCAnZmFpbGVkRW50aXRpZXNUYWJsZScpKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICAgICBhZGRDb3BpZWRFbnRpdGllc1RhYmxlKG51bU9mQ29waWVkRW50aXRpZXMsIGxpc3RPZkNvcGllZEVudGl0aWVzKTtcbiAgICAgICAgICAgIGFkZEZhaWxlZEVudGl0aWVzVGFibGUobnVtT2ZGYWlsZWRFbnRpdGllcywgbGlzdE9mRmFpbGVkRW50aXRpZXMpO1xuICAgICAgICBcbiAgICAgICAgICAgIC8vIGFkZFdvcmtzaGVldE5vdGUoJ05vdGUtIHRoZSBsaXN0IG9mIHRoZSBjb3BpZWQvZmFpbGVkIGVudGl0aWVzIHdpbGwgbm90IGJlIGxpbWl0ZWQgYnkgdGhlIGFycmF5IHNpemUnLCB3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYnVpbGRMaXN0T2ZSZWZlcmVuY2VUYWJsZXMgPSBmdW5jdGlvbiAod29ya3NoZWV0LCB0YWJEYXRhKSB7XG4gICAgICAgICAgICB2YXIgbnVtT2ZDb3BpZWRFbnRpdGllcyA9IHRhYkRhdGFbJ051bWJlciBvZiBDb3BpZWQgUmVmZXJlbmNlIFRhYmxlcyddWzBdLmNvdW50O1xuICAgICAgICAgICAgdmFyIGxpc3RPZkNvcGllZEVudGl0aWVzID0gdGFiRGF0YVsnTGlzdCBvZiBDb3BpZWQgUmVmZXJlbmNlIFRhYmxlcyddO1xuICAgICAgICAgICAgdmFyIG51bU9mRmFpbGVkRW50aXRpZXMgPSB0YWJEYXRhWydOdW1iZXIgb2YgRmFpbGVkIFJlZmVyZW5jZSBUYWJsZXMnXVswXS5jb3VudDtcbiAgICAgICAgICAgIHZhciBsaXN0T2ZGYWlsZWRFbnRpdGllcyA9IHRhYkRhdGFbJ0xpc3Qgb2YgRmFpbGVkIFJlZmVyZW5jZSBUYWJsZXMnXTtcbiAgICAgICAgXG4gICAgICAgICAgICB2YXIgYWRkQ29waWVkUmVmVGFibGUgPSBmdW5jdGlvbiAobnVtT2ZDb3BpZWRFbnRpdGllcywgbGlzdE9mQ29waWVkRW50aXRpZXMpIHtcbiAgICAgICAgICAgICAgICBhZGRXb3Jrc2hlZXRUaXRsZSgnTnVtYmVyIG9mICcgKyBnZW5lcmFsSW5mby5iZV9uYW1lICsgJyBDb3BpZWQgUmVmZXJlbmNlIFRhYmxlczogJyArIG51bU9mQ29waWVkRW50aXRpZXMsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChudW1PZkNvcGllZEVudGl0aWVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUoZ2V0VGFibGVNb2RlbChsaXN0T2ZDb3BpZWRFbnRpdGllcywgd29ya3NoZWV0LCAnY29waWVkUmVmVGFibGUnKSk7XG4gICAgICAgICAgICAgICAgICAgIGFkZEVtcHR5TGluZSh3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgICAgIHZhciBhZGRGYWlsZWRSZWZUYWJsZSA9IGZ1bmN0aW9uIChudW1PZkZhaWxlZEVudGl0aWVzLCBsaXN0T2ZGYWlsZWRFbnRpdGllcykge1xuICAgICAgICAgICAgICAgIGFkZFdvcmtzaGVldFRpdGxlKCdOdW1iZXIgb2YgJyArIGdlbmVyYWxJbmZvLmJlX25hbWUgKyAnIEZhaWxlZCBSZWZlcmVuY2UgVGFibGVzOiAnICsgbnVtT2ZGYWlsZWRFbnRpdGllcywgd29ya3NoZWV0KTtcbiAgICAgICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKG51bU9mRmFpbGVkRW50aXRpZXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldC5hZGRUYWJsZShnZXRUYWJsZU1vZGVsKGxpc3RPZkZhaWxlZEVudGl0aWVzLCB3b3Jrc2hlZXQsICdmYWlsZWRSZWZUYWJsZScpKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICAgICBhZGRDb3BpZWRSZWZUYWJsZShudW1PZkNvcGllZEVudGl0aWVzLCBsaXN0T2ZDb3BpZWRFbnRpdGllcyk7XG4gICAgICAgICAgICBhZGRGYWlsZWRSZWZUYWJsZShudW1PZkZhaWxlZEVudGl0aWVzLCBsaXN0T2ZGYWlsZWRFbnRpdGllcyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYnVpbGRFcnJvclN1bW1hcnlUYWIgPSBmdW5jdGlvbiAod29ya3NoZWV0LCB0YWJEYXRhKSB7XG4gICAgICAgICAgICB2YXIgaT0wO1xuICAgICAgICBcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHRhYkRhdGEpLmZvckVhY2goZnVuY3Rpb24gKHRhYmxlVGl0bGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGFibGVEYXRhID0gdGFiRGF0YVt0YWJsZVRpdGxlXTtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgaWYgKHRhYmxlRGF0YSAmJiB0YWJsZURhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZFdvcmtzaGVldFRpdGxlKHRhYmxlVGl0bGUsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgICAgIGFkZEVtcHR5TGluZSh3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUoZ2V0VGFibGVNb2RlbCh0YWJsZURhdGEsIHdvcmtzaGVldCwgJ2Vycm9yU3VtbWFyeScgKyBpKSk7XG4gICAgICAgICAgICAgICAgICAgIGFkZEVtcHR5TGluZSh3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYnVpbGRTdGF0aXN0aWNzUmVwb3J0VGFiID0gZnVuY3Rpb24gKHdvcmtzaGVldCwgdGFiRGF0YSkge1xuICAgICAgICBcbiAgICAgICAgICAgIGlmICghdGFiRGF0YSB8fCAhdGFiRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBhZGRXb3Jrc2hlZXRXYXJuaW5nKCdObyBTdGF0aXN0aWNzIFJlcG9ydCBEYXRhJywgd29ya3NoZWV0KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUoZ2V0VGFibGVNb2RlbCh0YWJEYXRhLCB3b3Jrc2hlZXQsICdzdGF0aXN0aWNzUmVwb3J0VGFibGUnKSk7XG4gICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBidWlsZFNlcXVlbmNlU3VtbWFyeVRhYiA9IGZ1bmN0aW9uICh3b3Jrc2hlZXQsIHRhYkRhdGEpIHtcbiAgICAgICAgICAgIGlmICghdGFiRGF0YSB8fCAhdGFiRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBhZGRXb3Jrc2hlZXRXYXJuaW5nKCdObyBTZXF1ZW5jZSBTdW1tYXJ5IFJlcG9ydCBEYXRhJywgd29ya3NoZWV0KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3b3Jrc2hlZXQuYWRkVGFibGUoZ2V0VGFibGVNb2RlbCh0YWJEYXRhLCB3b3Jrc2hlZXQsICdzZXF1ZW5jZVN1bW1hcnlUYWJsZScpKTtcbiAgICAgICAgICAgIGFkZEVtcHR5TGluZSh3b3Jrc2hlZXQpO1xuICAgICAgICBcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgYnVpbGRFcnJvckRldGFpbHNUYWIgPSBmdW5jdGlvbiAod29ya3NoZWV0LCB0YWJEYXRhKSB7XG4gICAgICAgICAgICBpZiAoIXRhYkRhdGEgfHwgIXRhYkRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYWRkV29ya3NoZWV0V2FybmluZygnTm8gRXJyb3IgRGV0YWlscyBSZXBvcnQgRGF0YScsIHdvcmtzaGVldCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd29ya3NoZWV0LmFkZFRhYmxlKGdldFRhYmxlTW9kZWwodGFiRGF0YSwgd29ya3NoZWV0LCAnZXJyb3JEZXRhaWxzVGFibGUnKSk7XG4gICAgICAgICAgICBhZGRFbXB0eUxpbmUod29ya3NoZWV0KTtcbiAgICAgICAgXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGJ1aWxkRXJyb3JTdW1tYXJ5VGFiID0gZnVuY3Rpb24gKHdvcmtzaGVldCwgdGFiRGF0YSkge1xuICAgICAgICAgICAgaWYgKCF0YWJEYXRhIHx8ICF0YWJEYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGFkZFdvcmtzaGVldFdhcm5pbmcoJ05vIEVycm9yIFN1bW1hcnkgUmVwb3J0IERhdGEnLCB3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdvcmtzaGVldC5hZGRUYWJsZShnZXRUYWJsZU1vZGVsKHRhYkRhdGEsIHdvcmtzaGVldCwgJ2Vycm9yU3VtbWFyeVRhYmxlJykpO1xuICAgICAgICAgICAgYWRkRW1wdHlMaW5lKHdvcmtzaGVldCk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYnVpbGRFeHRyYWN0VGFiID0gZnVuY3Rpb24gKHRhYk5hbWUsIHRhYkRhdGEsIHdvcmtzaGVldCkge1xuICAgICAgICAgICAgc3dpdGNoICh0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnR2VuZXJhbCBJbmZvJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRHZW5lcmFsSW5mb1RhYih3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdUYXNrIEV4ZWN1dGlvbiBTdW1tYXJ5JzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRFeHRyYWN0VGFza0V4ZWN1dGlvblN1bW1hcnkod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTGlzdCBvZiBSb290IEVudGl0aWVzJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRMaXN0T2ZSb290RW50aXRpZXNUYWIod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTGlzdCBvZiBSZWZlcmVuY2UgVGFibGVzJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRMaXN0T2ZSZWZlcmVuY2VUYWJsZXMod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnRXJyb3IgU3VtbWFyeSc6XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkRXJyb3JTdW1tYXJ5VGFiKHdvcmtzaGVldCwgdGFiRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgYnVpbGRMb2FkVGFiID0gZnVuY3Rpb24gKHRhYk5hbWUsIHRhYkRhdGEsIHdvcmtzaGVldCkge1xuICAgICAgICAgICAgc3dpdGNoICh0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnR2VuZXJhbCBJbmZvJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRHZW5lcmFsSW5mb1RhYih3b3Jrc2hlZXQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdUYXNrIEV4ZWN1dGlvbiBTdW1tYXJ5JzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRMb2FkVGFza0V4ZWN1dGlvblN1bW1hcnkod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTGlzdCBvZiBSb290IEVudGl0aWVzJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRMaXN0T2ZSb290RW50aXRpZXNUYWIod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnTGlzdCBvZiBSZWZlcmVuY2UgVGFibGVzJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRMaXN0T2ZSZWZlcmVuY2VUYWJsZXMod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnRXJyb3IgU3VtbWFyeSc6XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkRXJyb3JTdW1tYXJ5VGFiKHdvcmtzaGVldCwgdGFiRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1N0YXRpc3RpY3MgUmVwb3J0JzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRTdGF0aXN0aWNzUmVwb3J0VGFiKHdvcmtzaGVldCwgdGFiRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1JlcGxhY2UgU2VxdWVuY2UgU3VtbWFyeSBSZXBvcnQnOlxuICAgICAgICAgICAgICAgICAgICBidWlsZFNlcXVlbmNlU3VtbWFyeVRhYih3b3Jrc2hlZXQsIHRhYkRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdFcnJvciBEZXRhaWxzJzpcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRFcnJvckRldGFpbHNUYWIod29ya3NoZWV0LCB0YWJEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgLy8gY2FzZSAnRXJyb3IgU3VtbWFyeSc6XG4gICAgICAgICAgICAgICAgLy8gICAgIGJ1aWxkRXJyb3JTdW1tYXJ5VGFiKHdvcmtzaGVldCwgdGFiRGF0YSk7XG4gICAgICAgICAgICAgICAgLy8gICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IGFzc2lnbldvcmtzaGVldENvbHVtbnNXaWR0aCA9IHdvcmtzaGVldCA9PiB7XG4gICAgICAgICAgICBpZiAoIXdvcmtzaGVldC5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3Jrc2hlZXQuY29sdW1ucy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIGxldCBkYXRhTWF4ID0gMDtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSB3b3Jrc2hlZXQuY29sdW1uc1tpXTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgY29sdW1uLnZhbHVlc1tqXSAmJiBqIDwgY29sdW1uLnZhbHVlcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW5MZW5ndGggPSBjb2x1bW4udmFsdWVzW2pdLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbkxlbmd0aCA+IGRhdGFNYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFNYXggPSBjb2x1bW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29sdW1uLndpZHRoID0gZGF0YU1heCA8IDEwID8gMjAgOiBkYXRhTWF4ICsgMjA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGJ1aWxkRXhjZWwgPSAgZnVuY3Rpb24gKHdvcmtib29rLCBkYXRhKSB7XG4gICAgICAgICAgICB2YXIgdGFza1R5cGUgPSBnZW5lcmFsSW5mby50YXNrX3R5cGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goZnVuY3Rpb24gKHRhYk5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgd29ya3NoZWV0ID0gd29ya2Jvb2suYWRkV29ya3NoZWV0KHRhYk5hbWUpO1xuICAgICAgICAgICAgICAgIHZhciB0YWJEYXRhID0gZGF0YVt0YWJOYW1lXTtcbiAgICAgICAgICAgICAgICB0YXNrVHlwZSA9PT0gJ2V4dHJhY3QnID8gYnVpbGRFeHRyYWN0VGFiKHRhYk5hbWUsIHRhYkRhdGEgfHwge30sIHdvcmtzaGVldCkgOiBidWlsZExvYWRUYWIodGFiTmFtZSwgdGFiRGF0YSB8fCB7fSwgd29ya3NoZWV0KSA7XG5cbiAgICAgICAgICAgICAgICBhc3NpZ25Xb3Jrc2hlZXRDb2x1bW5zV2lkdGgod29ya3NoZWV0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBidWlsZFN1bW1hcnlFeGNlbCA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKTtcbiAgICAgICAgICAgIHNldEdlbmVyYWxJbmZvKGRhdGFbJ0dlbmVyYWwgSW5mbyddWzBdKTtcbiAgICAgICAgICAgIGJ1aWxkRXhjZWwod29ya2Jvb2ssIGRhdGEpO1xuICAgICAgICAgICAgcmV0dXJuIHdvcmtib29rO1xuICAgICAgICB9O1xuICAgICAgICBcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYnVpbGRTdW1tYXJ5RXhjZWwgOiBidWlsZFN1bW1hcnlFeGNlbCxcbiAgICAgICAgfVxuICAgIH0pIl19
