tags: Create
stages:
  Check Flag:
    actors:
      is_first_deploy:
        parent: Const
        remark: A boolean representing if this is the first deploy
        in:
          value:
            const: null
            external: is_first_deploy
            schema: boolean
        out:
          value:
            schema: boolean
  'True':
    dependsOn: Check Flag
    actors:
      Equals:
        parent: Equals
        condition: result
        in:
          a:
            link: is_first_deploy/value
            schema: boolean
          b:
            const: true
            schema: boolean
    split: '--------------------'
  'False':
    else: true
    transactional: false
    dependsOn: Check Flag
  Insert Data To CRM:
    dependsOn: 'True'
    actors:
      CRM:
        parent: InnerFlow
        in:
          flowName:
            const: populateDbs
          interface:
            const: CRM_DB
            schema: string
            editor:
              id: com.k2view.interface
              interfaceType:
              - database
              - CassandraLoader
              interfaces:
              - fabric
            mandatory: false
          path:
            const: TDM/DEMO/crm.sql.gz
            schema: string
            mandatory: false
    split: '--------------------'
  Stage 1:
    transactional: false
    dependsOn: 'False'
  Insert Data To Billing:
    dependsOn: Insert Data To CRM
    actors:
      BILLING:
        parent: InnerFlow
        in:
          flowName:
            const: populateDbs
          interface:
            const: BILLING_DB
            schema: string
            editor:
              id: com.k2view.interface
              interfaceType:
              - database
              - CassandraLoader
              interfaces:
              - fabric
            mandatory: false
          path:
            const: TDM/DEMO/billing.sql.gz
            schema: string
            mandatory: false
    split: '--------------------'
  Stage 2:
    transactional: false
    dependsOn: Stage 1
  Insert Data To Collection:
    dependsOn: Insert Data To Billing
    actors:
      COLLECTION:
        parent: InnerFlow
        disabled: true
        in:
          flowName:
            const: populateDbs
          interface:
            const: COLLECTION_DB
            schema: string
            editor:
              id: com.k2view.interface
              interfaceType:
              - database
              - CassandraLoader
              interfaces:
              - fabric
            mandatory: false
          path:
            const: TDM/DEMO/collection.sql.gz
            schema: string
            mandatory: false
    split: '--------------------'
  Stage 3:
    transactional: false
    dependsOn: Stage 2
  Insert Data To Orders:
    dependsOn: Insert Data To Collection
    actors:
      ORDERS:
        parent: InnerFlow
        disabled: true
        in:
          flowName:
            const: populateDbs
          interface:
            const: ORDERS_DB
            schema: string
            editor:
              id: com.k2view.interface
              interfaceType:
              - database
              - CassandraLoader
              interfaces:
              - fabric
            mandatory: false
          path:
            const: TDM/DEMO/orders.sql.gz
            schema: string
            mandatory: false
    split: '--------------------'
  Stage 4:
    transactional: false
    dependsOn: Stage 3
