tags: Create
stages:
  Check Flag:
    actors:
      is_first_deploy:
        parent: Const
        remark: A boolean representing if this is the first deploy
        in:
          value:
            const: null
            external: is_first_deploy
            schema: boolean
        out:
          value:
            schema: boolean
  'True':
    dependsOn: Check Flag
    actors:
      Equals:
        parent: Equals
        condition: result
        in:
          a:
            link: is_first_deploy/value
            schema: boolean
          b:
            const: true
            schema: boolean
    split: '--------------------'
  'False':
    else: true
    transactional: false
    dependsOn: Check Flag
  Create DBS & Roles:
    dependsOn: 'True'
    actors:
      createRolesAndDbs:
        parent: InnerFlow
        in:
          flowName:
            const: createRolesAndDbs
    split: '--------------------'
  Stage 1:
    transactional: false
    dependsOn: 'False'
  Create SRC Schema:
    dependsOn: Create DBS & Roles
    actors:
      createSRCDbs:
        parent: InnerFlow
        in:
          flowName:
            const: createSRCDbs
    split: '--------------------'
  Stage 2:
    transactional: false
    dependsOn: Stage 1
  Create TAR Schema:
    dependsOn: Create SRC Schema
    actors:
      createTARDbs:
        parent: InnerFlow
        in:
          flowName:
            const: createTARDbs
    split: '--------------------'
  Stage 3:
    transactional: false
    dependsOn: Stage 2
  Create Fabric Roles:
    dependsOn: Create TAR Schema
    actors:
      createFabricRolesWithPermissions:
        parent: InnerFlow
        in:
          flowName:
            const: createFabricRolesWithPermissions
    split: '--------------------'
  Stage 5:
    transactional: false
    dependsOn: Stage 3
  Add Email:
    transactional: false
    dependsOn: Create Fabric Roles
    actors:
      updateEmailField:
        parent: InnerFlow
        in:
          flowName:
            const: updateEmailField
    split: '--------------------'
  Stage 10:
    dependsOn: Stage 5
  Remove Interface:
    transactional: false
    dependsOn: Add Email
    actors:
      deleteInterfaces:
        parent: InnerFlow
        in:
          flowName:
            const: deleteInterfaces
    split: '--------------------'
  Stage 4:
    dependsOn: Stage 10
