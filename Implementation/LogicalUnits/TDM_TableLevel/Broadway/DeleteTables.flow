stages:
  Get List Of Tables And Delete Indicator:
    actors:
      Get Delete Or Truncate Indicator:
        parent: MTableLookup
        in:
          mtable:
            const: TableLevelInterfaces
          interface_name:
            external: interface
            schema: any
            editor:
              id: com.k2view.mTableKey
            mandatory: false
        out:
          truncate_indicator:
            schema: any
      List Of Tables:
        parent: Const
        in:
          value:
            const: null
            external: tablesForDelete
            schema: '#ref'
        out:
          value:
            schema: '#ref'
  Delete One Table:
    last: 1
    actors:
      Error Handler:
        parent: ErrorHandler
        error: result
        in:
          config:
            const:
            - exceptionKey: java.lang.Exception
              conditions:
                message: ''
              actions:
                suppress: false
                log: true
                flowName: PopulateTableErrorsForTableLevel
      Set Target Entity ID:
        parent: FabricSet
        in:
          key:
            const: TARGET_ENTITY_ID
            default: false
          value:
            const: null
            link:
              path: List Of Tables/value
              iterate: Iterate
            default: false
      Delete Table:
        parent: InnerFlowAsync
        in:
          flowName:
            const: DeleteOneTable
          interface:
            external: interface
            schema: string
            editor:
              id: com.k2view.interface
              interfaceType:
              - database
              - CassandraLoader
              interfaces:
              - fabric
            mandatory: false
          schema:
            external: schema
            schema: string
            editor:
              id: com.k2view.dbtable
            mandatory: false
          table:
            link:
              path: List Of Tables/value
              iterate: Iterate
            schema: string
            editor:
              id: com.k2view.dbtable
            mandatory: false
          deleteOrTruncate:
            link: Get Delete Or Truncate Indicator/truncate_indicator
            schema: string
            mandatory: false
        out:
          results:
            schema: '#ref'
  Wait for All Tables:
    actors:
      Wait for All Tables to be Deleted:
        parent: InnerFlowJoin
        in:
          remaining:
            link: Delete Table/remaining
          failures:
            link: Delete Table/failures
      Sleep1:
        parent: Sleep
        disabled: true
        in:
          millis:
            const: 30000
schemas:
  List Of Tables.in.value:
    type: array
    items:
      type: string
  List Of Tables.out.value:
    type: array
    items:
      type: string
  Delete Table.out.results:
    type: array
    items: {
      }
