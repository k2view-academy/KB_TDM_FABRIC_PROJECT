tags: TDM
stages:
  Stage 1:
    actors:
      Get Project Directory:
        parent: InnerFlow
        in:
          flowName:
            const: GetProjectFolder
        out:
          PROJECT_FOLDER:
            schema: string
  Stage 2:
    actors:
      FlowTemplate:
        parent: FileRead
        in:
          interface:
            const: null
            link: Get Project Directory/PROJECT_FOLDER
          path:
            const: SharedObjects/Templates/populationRootTable.pop.flow.template
  Stage 3:
    actors:
      Const1:
        parent: Const
        in:
          value:
            const: null
            link: FlowTemplate/stream
        out:
          value:
            schema: '#ref'
  Stage 4:
    actors:
      Replace1:
        parent: Replace
        in:
          search:
            const: '{{__LU_NAME}}'
          replace:
            const: null
            external: LU_NAME
          string:
            link: Const1/value
  Stage 5:
    actors:
      Replace2:
        parent: Replace
        in:
          search:
            const: '{{TABLE_NAME}}'
          replace:
            const: null
            external: TABLE_NAME
          string:
            link: Replace1/string
  Stage 6:
    actors:
      Replace3:
        parent: Replace
        in:
          search:
            const: '{{KEY}}'
          replace:
            const: null
            external: TABLE_KEY
          string:
            link: Replace2/string
  Stage 7:
    actors:
      Replace4:
        parent: Replace
        in:
          search:
            const: '{{SOURCE_INTERFACE}}'
          replace:
            const: null
            external: SOURCE_INTERFACE
          string:
            link: Replace3/string
  Stage 8:
    actors:
      Replace5:
        parent: Replace
        in:
          search:
            const: '{{SOURCE_SCHEMA}}'
          replace:
            const: null
            external: SOURCE_SCHEMA
          string:
            link: Replace4/string
  Stage 9:
    actors:
      Replace6:
        parent: Replace
        in:
          search:
            const: '{{SOURCE_TABLE}}'
          replace:
            const: null
            external: SOURCE_TABLE
          string:
            link: Replace5/string
      LU Folder:
        parent: StringFormat
        in:
          format:
            const: ${LU_PATH}Tables/
          LU_PATH:
            external: LU_PATH
            schema: string
            mandatory: false
  Stage 11:
    dependsOn: Stage 9
    actors:
      IsNull1:
        parent: IsNull
        condition: result
        in:
          value:
            external: POPULATION_FLOW_NAME
            schema: string
      StringFormat1:
        parent: StringFormat
        in:
          format:
            const: ${TABLE_NAME}.population.flow
          TABLE_NAME:
            external: TABLE_NAME
            schema: string
            mandatory: false
    split: '--------------------'
  Stage 12:
    else: true
    dependsOn: Stage 9
    actors:
      Const2:
        parent: Const
        in:
          value:
            const: null
            external: POPULATION_FLOW_NAME
            schema: string
        out:
          value:
            schema: string
  Stage 10:
    actors:
      FileWrite1:
        parent: FileWrite
        in:
          interface:
            const: null
            link: LU Folder/string
          stream:
            link: Replace6/string
          path:
            link:
            - StringFormat1/string
            - Const2/value
schemas:
  Const1.out.value:
    type: array
    items:
      type: blob
