tags: TDM
stages:
  Stage 1:
    actors:
      Get Project Directory:
        parent: InnerFlow
        in:
          flowName:
            const: GetProjectFolder
        out:
          PROJECT_FOLDER:
            schema: string
      LuFunction2:
        parent: LuFunction
        height: 261
        in:
          functionName:
            const: buildTemplateData
          luTable:
            external: LU_TABLE
            schema: string
          targetDbInterface:
            external: TARGET_INTERFACE
            schema: string
          targetDbSchema:
            external: TARGET_SCHEMA
            schema: string
          targetDbTable:
            external: TARGET_TABLE
            schema: string
          tableIidFieldName:
            external: IID_FIELD_NAME
            schema: string
          sequenceName:
            external: SEQUENCE_NAME
            schema: string
          luName:
            external: luType
            schema: string
            mandatory: false
          flowType:
            const: LOAD
            schema: string
            mandatory: false
          useFabric:
            external: useFabric
            schema: boolean
            mandatory: false
        out:
          res:
            schema: '#ref'
  Stage 3:
    actors:
      FlowTemplate:
        parent: FileRead
        height: 153
        in:
          interface:
            const: null
            link: Get Project Directory/PROJECT_FOLDER
          path:
            const: SharedObjects/Templates/TDM/tdmLoadTable.flow.template
  Stage 4:
    actors:
      flow folder:
        parent: StringFormat
        in:
          format:
            const: ${PROJECT_DIRECTORY}/LogicalUnits/${LU_NAME}/Broadway/LoadFlows
          LU_NAME:
            external: luType
            schema: string
          PROJECT_DIRECTORY:
            link: Get Project Directory/PROJECT_FOLDER
            schema: string
            mandatory: false
      ApplyTemplate:
        parent: LuFunction
        in:
          functionName:
            const: transform
          templateContent:
            link: FlowTemplate/stream
            schema: string
          data:
            link: LuFunction2/res
            schema: string
        out:
          result:
            schema: string
  Stage 7:
    actors:
      FileWrite1:
        parent: FileWrite
        in:
          interface:
            const: null
            link: flow folder/string
          stream:
            link: ApplyTemplate/result
          path:
            external: FLOW_NAME
schemas:
  LuFunction2.out.res:
    type: object
    properties:
      LU_TABLE:
        type: string
      LU_TABLE_COLUMNS:
        type: array
        items:
          type: string
      MAIN_TABLE_SEQ_ID:
        type: string
      MAIN_TABLE_SEQ_NAME:
        type: string
      TABLE_SEQ_DATA:
        type: array
        items:
          type: object
          properties:
            column:
              type: string
            value:
              type: object
              properties:
                LU_NAME:
                  type: string
                TARGET_TABLE_NAME:
                  type: string
                TARGET_FIELD_NAME:
                  type: string
                FABRIC_TABLE_NAME:
                  type: string
                FABRIC_FIELD_NAME:
                  type: string
                SEQUENCE_NAME:
                  type: string
      TARGET_INTERFACE:
        type: string
      TARGET_SCHEMA:
        type: string
      TARGET_TABLE:
        type: string
      TARGET_TABLE_COLUMNS:
        type: array
        items:
          type: string
      TARGET_TABLE_PKS:
        type: array
        items:
          type: string
